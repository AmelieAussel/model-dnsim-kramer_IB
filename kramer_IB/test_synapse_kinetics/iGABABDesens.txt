%% iGABABAustin: synaptic GABA-B-ergic inhibitory current
% This is, very slightly, an original formulation of the GABA-B current.
% The state variable [R] for GABAB is 'customized' here, in that, rather
%     than the popular formulation of a 0.5 mM box 0.3 ms long for the
%     transmitter amount, inherited from (Destexhe 1996), the VERY similar
%     2 * (1 + tanh( V / 4) ) method of calculating transmitter concentration
%     from (Olufsen 2003) is used. 0.3 ms is about as long as a neuron's
%     voltage is above 0 mV, the latter being the definition of when this
%     voltage-sensitive transmitter concentration is non-zero. The same
%     concentration amplitude was used since I had already seen a long time
%     of realistic results with GABAA responding to it, and GABAB's effect
%     obviously has a much more malleable effector in its maximal conductance.
% In many ways, this is a simplified version of the GABA-B current from (Vijayan
%     2012): instead of a fixed spike of transmitter concentration when the
%     presynaptic cell spikes, we use the same GABA concentration calculation
%     method from the GABA-A current.
%
% References:
% - Destexhe, A., Bal, T., McCormick, D. A., & Sejnowski, T. J. (1996). Ionic mechanisms underlying synchronized oscillations and propagating waves in a model of ferret thalamic slices. Journal of Neurophysiology, 76(3), 2049–2070.
% - Olufsen, M. S., Whittington, M. A., Camperi, M., & Kopell, N. (2003). New roles for the gamma rhythm: population tuning and preprocessing for the beta rhythm. Journal of Computational Neuroscience, 14(1), 33–54.
% - Vijayan, S., & Kopell, N. J. (2012). Thalamic model of awake alpha oscillations and implications for stimulus processing. Proceedings of the National Academy of Sciences, 109(45), 18553–18558. doi:10.1073/pnas.1215385109
%
% % Original Destexhe 1998
% K1=6.6*10^5         % M-1*sec-1
% K2=20               % sec-1
% K3=5.3              % sec-1
% K4=17               % sec-3
% K5=8.3*10^-5        % M*sec-1 (should be microM?)
% K6=7.9              % sec-1
% Kd = 100            % microM^4
%
% Tags: synapse, connection
% This was built using "iSYN.txt" as a template.
% From Austin Soplata 2015
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Parameters
gGABAB = [0.000];
EGABAB = [-95];
IC = [0.0];
IC_noise = [0];
TmaxGABAB=0.5;         % Austin default


% Adjust units
K1=6.6*10^-1         % mM-1*ms-1
K2=20 * 1e-3               % ms-1
K3=5.3 * 1e-3              % ms-1
K4=17 * 1e-3              % sec-3
K5=8.3*10^1 * 1e-3       % microM*ms-1 (should be microM?)
K6=7.9 * 1e-3             % ms-1
Kd = 100            % microM^4


% Connectivity
%width = inf   % fanout (connection distance)
%Nmax = max(Npre,Npost)
%srcpos = linspace(1,Nmax,Npre)'*ones(1,Npost)      % linear position (sources)
%dstpos = (linspace(1,Nmax,Npost)'*ones(1,Npre))'   % linear position (targets)
%netcon = (abs(srcpos-dstpos)<=width)              % adjacency matrix (connect elements closer than width)

% Functions
T(X) = TmaxGABAB*1/2*(1 + tanh(X./4))
T(X) = X        % Override transmitter concentration with identity function
gfour(g) = (G.^4./(G.^4 + 100))
IGABAB(g) = gGABAB * gfour(g)


% ODEs
R' = K1*T(X).*(1 - R - D) - K2*R + K3*D
D' = K4*R - K3*D
G' = K5*R - K6*G

R(0) = IC+IC_noise.*zeros(1,Npop);
D(0) = IC+IC_noise.*zeros(1,Npop);
G(0) = IC+IC_noise.*zeros(1,Npop);

monitor gfour

% Interface
@current += -IGABAB(g)
